<!DOCTYPE html>
{% load staticfiles %}
<html>
<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#3F51B5">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

    <title>Lithium // Project Manager</title>

    <script src="{% static 'bower_components/webcomponentsjs/webcomponents-lite.min.js' %}"></script>

    <link rel="import"
    href="{% static 'bower_components/paper-fab/paper-fab.html' %}">

    <link rel="import"
    href="{% static 'bower_components/iron-icons/iron-icons.html' %}">

    <link rel="import"
    href="{% static 'bower_components/paper-icon-button/paper-icon-button.html' %}">

    <link rel="import"
    href="{% static 'elements/tweaked-card.html' %}">

    <link rel="import"
    href="{% static 'elements/toolbar-element.html' %}">

    <link rel="import"
    href="{% static 'bower_components/iron-flex-layout/classes/iron-flex-layout.html' %}">

    <link rel="import"
    href="{% static 'bower_components/iron-form/iron-form.html' %}">

    <link rel="import"
    href="{% static 'elements/share-button.html' %}">

    <link rel="import"
    href="{% static 'elements/myproj-badge.html' %}">

  	<link rel="import"
  	href="{% static 'bower_components/paper-input/paper-input.html' %}">

  	<link rel="import"
  	href="{% static 'bower_components/paper-dialog/paper-dialog.html' %}">

	<link rel="import"
  	href="{% static 'bower_components/iron-scroll-target-behavior/iron-scroll-target-behavior.html' %}">

  	<link rel="import"
  	href="{% static 'bower_components/paper-input/paper-textarea.html' %}">

  	<link rel="import"
  	href="{% static 'bower_components/paper-tooltip/paper-tooltip.html' %}">

  	<link rel="import"
  	href="{% static 'bower_components/paper-drawer-panel/paper-drawer-panel.html' %}">

    <link rel="import"
    href="{% static 'bower_components/paper-header-panel/paper-header-panel.html' %}">

    <link rel="import"
    href="{% static 'bower_components/file-upload/file-upload.html' %}">

    <style>
        @import url({% static 'theme.css' %});
    </style>
</head>


	<script>
    function opendelay(uri) {
        setTimeout(function () {
    location.href=uri;
        }, 500);
    }

	function addProject() {
		document.getElementById('newprojdialog').open();
		document.getElementById('submitnewproj').addEventListener('iron-form-response', this.formResponse);
	}

	function submitProj() {
		document.getElementById('submitnewproj').submit();
	}

	function formResponse(e) {
		location.href="/";
	}

  function toggleDrawer() {
    var drw=document.getElementById('drawerpanel');
    var tbar=document.getElementById('mtbar');
    drw.togglePanel();
    tbar.drawerbtn=false;
    if (drw.narrow) tbar.drawerbtn=true;
  }

  function signout() {
    document.getElementById('signoutdialog').open();
  }
  function finallylogout() {
    location.href='/signout';
  }

  function openSettings() {
    document.getElementById('settingsdialog').open();
  }
    </script>




<body class="fullbleed vertical layout center">

		<paper-dialog id="newprojdialog" class="pdialog" modal>
		  <h2>New project...</h2>
        <form is="iron-form" id="submitnewproj" action="{% url 'submitnewproj' %}" method="POST">
					{% csrf_token %}
				<div class="vertical layout">
 			<paper-input class="cardcontent" label="Name" type="text" name="name" required></paper-input>
 			<paper-input class="cardcontent" label="Description" type="text" name="description"></paper-input>
 				</div>
		  <div class="buttons">
			<paper-button dialog-dismiss>Cancel</paper-button>
			<paper-button onclick="submitProj();">Create</paper-button>
		  </div>
		  	</form>
		</paper-dialog>

    <!--TODO: implement settings dialog-->
    <paper-dialog id="settingsdialog" class="pdialog" modal>
		  <h2>Settings</h2>
				<div class="vertical layout">
          <span>tkn: {{csrfmiddlewaretoken}}</span>
          <file-upload method="POST" target="{% url 'updateavatar' %}" mcsrftoken="{{ csrf_token }}">
            Profile picture</file-upload>
          
 				</div>
		  <div class="buttons">
			<paper-button dialog-dismiss>Done</paper-button>
		  </div>
		</paper-dialog>

    <paper-dialog id="signoutdialog" class="pdialog" modal>
		  <h2>Do you really want to sign out?</h2>
		  <div class="buttons">
			<paper-button dialog-dismiss>No</paper-button>
			<paper-button onclick="finallylogout();">Yes</paper-button>
		  </div>
		</paper-dialog>


      <div>
    	<paper-fab id="addfab" icon="add" onClick="addProject()"></paper-fab>
    	<paper-tooltip for="addfab" position="left">Add project</paper-tooltip>
    	</div>

      <paper-header-panel class="flex" style="width:100%;">
      <toolbar-element mtitle="" drawerbtn tbarposition="relative" class="paper-header" id="mtbar">
      <paper-icon-button class="middle" icon="menu" onclick="toggleDrawer()"></paper-icon-button>
      </toolbar-element>


		<paper-drawer-panel id="drawerpanel">
		<div main class="scrollable vertical layout center">


	{% if projlist %}
		{% for project in projlist %}
		<tweaked-card mtitle="{{project.name}}" csize="big">
			<span class="cardcontent">{{project.description}}</span>
			<div class="card-actions horizontal layout center">
 				<paper-button onclick="">Open</paper-button>
        <span class="flex"></span>
        {% if project.author.user == user %}
        <myproj-badge></myproj-badge>
        {% else %}
        <div>
          {% if project.author.avatar %}
            <img class="microavatar" src="{{project.author.avatar}}"></img>
          {% else %}
            <iron-icon icon="account-circle"></iron-icon>
          {% endif %}
        <paper-tooltip position="left">{{project.author.user.username}}</paper-tooltip>
        </div>
        {% endif %}
 			</div>
			</tweaked-card>
		{% endfor %}
    <div class="spacerFab"></div>
	{% else %}
		<h2>Nothing here</h2>
	{% endif %}

	</div>
	<div drawer id="mdrawer" class="vertical layout">
      <div class="drawerheader horizontal layout">
        {% if userpic %}
          <img id="avatarcircle" src="{{userpic}}"></img>
        {% else %}
          <img id="avatarcircle" src="/media/img/defaultuserpic.png"></img>
        {% endif %}
          <!--<paper-tooltip for="avatarcircle" position="right" >{{user.username}}</paper-tooltip>-->
          <span class="usrname">// {{user.username}}</span>
      </div>
      <div>
        <div class="bottombtncont">
          <paper-button class="fullbleedbtn" onclick="openSettings()">Settings</paper-button>
          <paper-button class="fullbleedbtn" onclick="signout()">Sign out</paper-button>
        </div>
      </div>
  </div>
		</paper-drawer-panel>
    </paper-header-panel>
</body>
</html>
